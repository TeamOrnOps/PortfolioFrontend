name: Deploy Frontend to Backend

on:
  push:
    branches:
      - main

jobs:
  sync-and-trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout frontend repository
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
        with:
          path: frontend-repo

      - name: Checkout backend repository
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
        with:
          repository: TeamOrnOps/PortfolioBackend
          token: ${{ secrets.BACKEND_REPO_TOKEN }}
          path: backend-repo

      - name: Copy frontend to backend repository
        run: |
          rm -rf backend-repo/frontend
          mkdir -p backend-repo/frontend
          cp -r frontend-repo/* backend-repo/frontend/
          # Remove .git folder from copied frontend
          rm -rf backend-repo/frontend/.git

      - name: Commit and push frontend changes to backend
        run: |
          cd backend-repo
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add -f frontend/
          git commit -m "Sync frontend from PortfolioFrontend" || echo "No changes to commit"
          git push